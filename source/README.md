# Directory Overview and Structure

The current directory hosts the tools & libraries relevant for validating the decompilation performed by McSema. The important tools are:

 - [Compositinal-Decompiler](https://github.com/sdasgup3/validating-binary-decompilation/tree/master/source/tools/decompiler)
    This is the compositional decompiler used for program level validation. For a given x86-64 program, the tool disassembles, using Objdump, and  decompiles, using McSema, each x86-64 instruction and composes the corresponding lifted LLVM IR to create LLVM IR program.
    - Associated Library Path: [compositional-decompiler](https://github.com/sdasgup3/validating-binary-decompilation/tree/master/source/libs/compositional-decompiler)

 - [Matcher](https://github.com/sdasgup3/validating-binary-decompilation/tree/master/source/tools/matcher)
    The matcher is responsible for doing "graph isomorphic matching" on the LLVM data-sependence graphs derived from (1) McSema decompiled LLVM IR, and (2) the LLVM IR generated by the above mentioned compositional decompiler.
    - Associated Library Path:   [llvm-graph-matching](https://github.com/sdasgup3/validating-binary-decompilation/tree/master/source/libs/llvm-graph-matching)

# Run Instructions
The above tools will be run as part of a pipleline (SIV or PLV )and will seldom
be run in isolation.  For the purpose of explanation, we are describing the
usage model of the individual tools.

```bash
# Set path of the directory containing validating-binary-decompilation repository
export REPO_PATH=${HOME}/Github/

# Set tool binary path
TOOLDIR=${REPO_PATH}/validating-binary-decompilation/source/build/bin/ # Set tool binary path

# The path to dump the output of compositional decompiler
${OURDIR}=<path>/

# The path to read the binary from
${INDIR}=<path>

# The path to cache the results of single instruction decompilation using McSema.
${ARTIFACTDIR}=${REPO_PATH}/compd_cache/

# compositional decompiler
 - Usage Model
  ${TOOLDIR}/decompiler  --output ${OUTDIR}test.proposed.ll --path ${ARTIFACTDIR} --function ${PROG} --input ${INDIR}test.reloc [--use-reloc-info]

 - An Example run
  cd ${REPO_PATH}/validating-binary-decompilation/tests/program_translation_validation/toy-examples/get-sign/get_sign
  make compd

# Running matcher
 - Usage Model
  ${TOOLDIR}/matcher --file1 ${OURDIR}test.opt.ll:${PROG} --file2 ${OURDIR}test.proposed.opt.ll:${PROG}

 - An Example
  cd ${REPO_PATH}/validating-binary-decompilation/tests/program_translation_validation/toy-examples/get-sign/get_sign
  make match

```


### Deprecated Tools
#### variable\_and\_basic\_block\_correspondence tool
 - Usage model
  ```
    validating-binary-decompilation/ir_analyzer/build/bin/variable_bb_correspondence
     [--decompiled-output <file>.ll or <file>.bc]
     [--target-function _${PROG}]
     [--init-state-function _init_var_correspondence]
     [--llvm-dfg-dot-out <file>.dot]
     [--llvm-dfg-pdf-out <file>.pdf]
     [--target binary.asm]
     [--no-fresh-mem]
     [--x86-dfg-pdf-out file.pdf]
  ```

 - Example run 
  ```
  cd $REPO_PATH/validating-binary-decompilation/tests/get_sign
  opt -load $REPO_PATH/validating-binary-decompilation/ir_analyzer/build/lib/LLVMvariable_correspondence.so  < get_sign_instrumented.ll   --var_corr -debug-only=variable_correspondence  -disable-output -target-function sub_660_get_sign -init-state-function sub_67b_init_var_correspondence
  ```
